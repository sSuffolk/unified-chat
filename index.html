<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>YouTube/Twitch Multi Chat ğŸ®âœ¨ğŸ’¬</title>
  <link rel="icon" href="https://www.youtube.com/s/desktop/ffaa45ee/img/favicon_32.png" type="image/png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" defer></script>
  <style>
    :root{
      --vh: 1vh;
      --tab-h: 48px;
      --bg:#f0f0f0; --hdr:#333; --txt:#fff; --border:#555;
      --accent:#61afef; --tab-bg:#444; --tab-active:#61afef;
      --btn:38px;

      /* live zoom values (stored/restored by JS) */
      --tz: 1;   /* Twitch zoom (1 = normal, <1 zooms out) */
      --yz: 1;   /* YouTube zoom */
    }
    html, body { height: calc(var(--vh) * 100); }
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg); display:flex; flex-direction:column; min-height: calc(var(--vh) * 100);
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility; overscroll-behavior-y:none;
    }

    /* Header */
    header{
      background:var(--hdr); color:var(--txt); padding:8px 10px;
      padding-top: calc(8px + env(safe-area-inset-top)); box-shadow:0 2px 5px rgba(0,0,0,.2);
    }
    .header-row{ display:flex; align-items:center; gap:8px; }
    h2{ margin:0; font-size:1.05rem; text-align:center; flex:1; }
    .toolbar{ display:flex; gap:6px; }
    .icon-btn{
      width:var(--btn); height:var(--btn); border:none; border-radius:999px; background:#4a4a4a; color:#fff;
      display:grid; place-items:center; box-shadow:0 2px 6px rgba(0,0,0,.25); cursor:pointer;
    }
    .icon-btn.primary{ background:var(--accent); }

    /* Controls */
    .controls{
      margin-top:8px;
      display:grid; grid-template-columns: 1fr 1fr auto; gap:8px;
    }
    .controls input{
      padding:10px; border:1px solid var(--border); border-radius:8px; background:#222; color:#fff; font-size:15px; min-width:0;
    }
    .controls button.save{
      padding:10px 14px; border:none; border-radius:8px; background:var(--accent); color:#fff; font-size:15px; cursor:pointer;
      white-space:nowrap;
    }
    @media (max-width: 560px){
      .controls{ grid-template-columns: 1fr; }
      .controls button.save{ width:100%; }
    }

    /* Tabs */
    .tab-buttons{
      position:fixed; left:0; right:0; bottom:0; display:flex; background:var(--tab-bg);
      padding-bottom: env(safe-area-inset-bottom); box-shadow:0 -2px 5px rgba(0,0,0,.15); z-index:20; height:var(--tab-h);
    }
    .tab-buttons button{ flex:1; border:none; background:transparent; color:#fff; font-size:15px; }
    .tab-buttons button.active{ background:var(--tab-active); }

    /* Chat area */
    .chat-wrapper{ flex:1; display:flex; overflow:hidden; padding-bottom: var(--tab-h); }
    .chat-container{ flex:1; display:none; flex-direction:column; }
    .chat-container.active{ display:flex; }
    .split{ flex:1; display:flex; gap:4px; padding:4px; }
    @media (orientation: portrait){ .split{ flex-direction:column; } }
    @media (orientation: landscape){ .split{ flex-direction:row; } }
    .pane{ flex:1; display:flex; min-height:0; min-width:0; }

    /* Iframes */
    iframe{ flex:1; border:0; background:#000; }

    /* Zoom wrappers (no cropping; we grow the inner box) */
    .zoom-wrap{ position:relative; width:100%; height:100%; overflow:auto; }
    .zoom-inner{ position:absolute; top:0; left:0; width:100%; height:100%; transform-origin: top left; }

    .zoom-twitch .zoom-inner{ transform: scale(var(--tz)); width: calc(100% / var(--tz)); height: calc(100% / var(--tz)); }
    .zoom-youtube .zoom-inner{ transform: scale(var(--yz)); width: calc(100% / var(--yz)); height: calc(100% / var(--yz)); }

    .single{ flex:1; padding:4px; }
    .single .zoom-wrap{ width:100%; height:100%; }

    /* Reading mode */
    body.reading header{ display:none; }
    body.reading .tab-buttons{ transform: translateY(100%); }
    body.reading .chat-wrapper{ padding-bottom: 0; }

    /* Hot zones to exit reading mode */
    .hotzone{ position:fixed; left:0; right:0; z-index:25; display:none; background:rgba(0,0,0,0); }
    .hotzone.top{ top:0; height:42px; }
    .hotzone.bottom{ bottom:0; height:52px; }
    body.reading .hotzone{ display:block; }

    /* Modals */
    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; align-items:center; justify-content:center; z-index:40; }
    .modal.open{ display:flex; }
    .modal-card{ background:#111; color:#fff; padding:16px; border-radius:12px; width:min(92vw, 420px); display:flex; flex-direction:column; gap:12px; }
    .row{ display:flex; flex-wrap:wrap; gap:8px; }
    .row button{ flex:1; min-width:120px; padding:10px; border:none; border-radius:8px; background:#333; color:#fff; }
    .qr-box{ background:#fff; padding:8px; border-radius:8px; align-self:center; }
    .modal h3{ margin:0; font-size:1rem; text-align:center; }
    .zoom-row button{ min-width:auto; flex:0 0 auto; padding:8px 10px; }
  </style>
</head>
<body>
  <!-- Tap top or bottom while in Reading mode to restore UI -->
  <div id="hz-top" class="hotzone top" aria-hidden="true"></div>
  <div id="hz-bottom" class="hotzone bottom" aria-hidden="true"></div>

  <header>
    <div class="header-row">
      <div class="toolbar">
        <button id="btn-reading" class="icon-btn" title="Reading mode">ğŸ“–</button>
      </div>
      <h2>YouTube/Twitch Multi Chat</h2>
      <div class="toolbar">
        <button id="btn-share" class="icon-btn primary" title="Share">ğŸ”—</button>
        <button id="btn-more" class="icon-btn" title="More">â‹¯</button>
      </div>
    </div>
    <div class="controls">
      <input id="twitch-input" type="text" placeholder="Twitch channel"/>
      <input id="yt-input" type="text" placeholder="YouTube LIVE URL or ID"/>
      <button id="save-both" class="save">Save</button>
    </div>
  </header>

  <div class="chat-wrapper">
    <div id="both" class="chat-container active">
      <div class="split">
        <div class="pane">
          <div class="zoom-wrap zoom-twitch">
            <div class="zoom-inner"><iframe id="twitch-iframe" title="Twitch Chat"></iframe></div>
          </div>
        </div>
        <div class="pane">
          <div class="zoom-wrap zoom-youtube">
            <div class="zoom-inner"><iframe id="youtube-iframe" title="YouTube Chat"></iframe></div>
          </div>
        </div>
      </div>
    </div>

    <div id="twitch" class="chat-container">
      <div class="single">
        <div class="zoom-wrap zoom-twitch"><div class="zoom-inner"><iframe id="twitch-only-iframe" title="Twitch Chat (Single View)"></iframe></div></div>
      </div>
    </div>

    <div id="youtube" class="chat-container">
      <div class="single">
        <div class="zoom-wrap zoom-youtube"><div class="zoom-inner"><iframe id="youtube-only-iframe" title="YouTube Chat (Single View)"></iframe></div></div>
      </div>
    </div>
  </div>

  <div id="tabs" class="tab-buttons" role="tablist" aria-label="Chat views">
    <button class="active" data-tab="both" role="tab" aria-selected="true">Both</button>
    <button data-tab="twitch" role="tab" aria-selected="false">Twitch</button>
    <button data-tab="youtube" role="tab" aria-selected="false">YouTube</button>
  </div>

  <!-- Share Modal -->
  <div id="modal-share" class="modal" aria-hidden="true">
    <div class="modal-card">
      <h3>Share</h3>
      <div id="qr" class="qr-box"></div>
      <div class="row"><button id="share-copy">Copy Link</button><button id="share-close">Close</button></div>
    </div>
  </div>

  <!-- More Modal (popouts + zoom controls) -->
  <div id="modal-more" class="modal" aria-hidden="true">
    <div class="modal-card">
      <h3>More</h3>
      <div class="row">
        <button id="popout-twitch-chat">Twitch Chat ğŸš€</button>
        <button id="popout-yt-chat">YouTube Chat ğŸš€</button>
      </div>
      <div class="row">
        <button id="popout-twitch-stream">Twitch Stream â–¶ï¸</button>
        <button id="popout-yt-stream">YouTube Stream â–¶ï¸</button>
      </div>

      <!-- Zoom controls -->
      <div class="row zoom-row" style="justify-content:center;margin-top:8px;">
        <strong style="flex:0 0 auto;">Twitch zoom:</strong>
        <button id="tz-out">âˆ’</button>
        <button id="tz-reset">100%</button>
        <button id="tz-in">+</button>
      </div>
      <div class="row zoom-row" style="justify-content:center;">
        <strong style="flex:0 0 auto;">YouTube zoom:</strong>
        <button id="yz-out">âˆ’</button>
        <button id="yz-reset">100%</button>
        <button id="yz-in">+</button>
      </div>

      <div class="row"><button id="more-close">Close</button></div>
    </div>
  </div>

<script>
/* Elements */
const twitchInput=document.getElementById('twitch-input');
const ytInput=document.getElementById('yt-input');
const saveBtn=document.getElementById('save-both');

const tabs=document.querySelectorAll('.tab-buttons button');
const containers=document.querySelectorAll('.chat-container');

const twitchIframe=document.getElementById('twitch-iframe');
const twitchOnly=document.getElementById('twitch-only-iframe');
const ytIframe=document.getElementById('youtube-iframe');
const ytOnly=document.getElementById('youtube-only-iframe');

const btnReading=document.getElementById('btn-reading');
const btnShare=document.getElementById('btn-share');
const btnMore=document.getElementById('btn-more');

const modalShare=document.getElementById('modal-share');
const modalMore=document.getElementById('modal-more');
const qrBox=document.getElementById('qr');

const hzTop=document.getElementById('hz-top');
const hzBottom=document.getElementById('hz-bottom');

/* Zoom buttons */
const tzOut=document.getElementById('tz-out');
const tzIn=document.getElementById('tz-in');
const tzReset=document.getElementById('tz-reset');
const yzOut=document.getElementById('yz-out');
const yzIn=document.getElementById('yz-in');
const yzReset=document.getElementById('yz-reset');

/* Helpers */
const parentHost=window.location.hostname||'127.0.0.1';
const TWITCH_EMBED=(ch)=>`https://www.twitch.tv/embed/${ch}/chat?parent=${parentHost}&darkpopout`;
const YT_CHAT=(id)=>`https://www.youtube.com/live_chat?v=${id}&is_popout=1&embed_domain=${parentHost}`;
const sanitizeTwitch=(c)=>c.replace(/[^a-zA-Z0-9_]/g,'').toLowerCase();
function extractYtId(v){if(!v)return'';const r=/^[A-Za-z0-9_-]{11}$/;if(r.test(v))return v;const m=v.match(/(?:v=|\/)([A-Za-z0-9_-]{11})/);return m?m[1]:'';}

function buildShareUrl(tw=(localStorage.getItem('twitchChannel')||''), yt=(localStorage.getItem('ytId')||'')){
  const u=new URL(location.href);
  if(tw) u.searchParams.set('twitch',tw); else u.searchParams.delete('twitch');
  if(yt) u.searchParams.set('yt',yt); else u.searchParams.delete('yt');
  return u.toString();
}
function applyFromUrl(){
  const p=new URLSearchParams(location.search);
  const tw=p.get('twitch'); const yt=p.get('yt');
  if(tw) localStorage.setItem('twitchChannel',sanitizeTwitch(tw));
  if(yt) localStorage.setItem('ytId',extractYtId(yt));
}
function updateUrl(){ history.replaceState(null,'',buildShareUrl()); }

/* Load iframes */
function loadChats(){
  const tw=localStorage.getItem('twitchChannel')||'';
  const yt=localStorage.getItem('ytId')||'';
  if(tw){
    const s=TWITCH_EMBED(tw);
    if(twitchIframe.src!==s) twitchIframe.src=s;
    if(twitchOnly.src!==s) twitchOnly.src=s;
    twitchInput.value=tw;
  }
  if(yt){
    const s=YT_CHAT(yt);
    if(ytIframe.src!==s) ytIframe.src=s;
    if(ytOnly.src!==s) ytOnly.src=s;
    ytInput.value=yt;
  }
}

/* Save */
saveBtn.onclick=()=>{
  const tw=sanitizeTwitch(twitchInput.value.trim());
  const yt=extractYtId(ytInput.value.trim());
  if(tw) localStorage.setItem('twitchChannel',tw);
  if(yt) localStorage.setItem('ytId',yt);
  loadChats(); updateUrl();
};

/* Tabs */
tabs.forEach(btn=>{
  btn.addEventListener('click',()=>{
    tabs.forEach(b=>{b.classList.remove('active'); b.setAttribute('aria-selected','false');});
    containers.forEach(c=>c.classList.remove('active'));
    btn.classList.add('active'); btn.setAttribute('aria-selected','true');
    document.getElementById(btn.dataset.tab).classList.add('active');
  },{passive:true});
});

/* Reading mode + hot zones */
function setReading(on){
  document.body.classList.toggle('reading',on);
  localStorage.setItem('reading',on?'1':'0');
}
btnReading.onclick=()=> setReading(!document.body.classList.contains('reading'));
function exitReading(){ if(document.body.classList.contains('reading')) setReading(false); }
hzTop.addEventListener('click', exitReading);
hzBottom.addEventListener('click', exitReading);

/* Share modal */
btnShare.onclick=()=>{
  modalShare.classList.add('open');
  qrBox.innerHTML='';
  new QRCode(qrBox,{text:buildShareUrl(),width:200,height:200});
};
document.getElementById('share-copy').onclick=()=>navigator.clipboard.writeText(buildShareUrl());
document.getElementById('share-close').onclick=()=>modalShare.classList.remove('open');
modalShare.addEventListener('click',(e)=>{ if(e.target===modalShare) modalShare.classList.remove('open'); });

/* More (popouts + zoom) */
btnMore.onclick=()=>modalMore.classList.add('open');
document.getElementById('more-close').onclick=()=>modalMore.classList.remove('open');
modalMore.addEventListener('click',(e)=>{ if(e.target===modalMore) modalMore.classList.remove('open'); });

document.getElementById('popout-twitch-chat').onclick=()=>{
  const tw=localStorage.getItem('twitchChannel'); if(!tw) return alert('Save a Twitch channel first.');
  window.open(`https://www.twitch.tv/popout/${tw}/chat?popout=`,'_blank','noopener');
};
document.getElementById('popout-yt-chat').onclick=()=>{
  const yt=localStorage.getItem('ytId'); if(!yt) return alert('Save your YouTube LIVE ID first.');
  window.open(YT_CHAT(yt),'_blank','noopener');
};
document.getElementById('popout-twitch-stream').onclick=()=>{
  const tw=localStorage.getItem('twitchChannel'); if(!tw) return alert('Save a Twitch channel first.');
  window.open(`https://player.twitch.tv/?channel=${tw}&parent=${parentHost}`,'_blank','noopener');
};
document.getElementById('popout-yt-stream').onclick=()=>{
  const yt=localStorage.getItem('ytId'); if(!yt) return alert('Save your YouTube LIVE ID first.');
  window.open(`https://www.youtube.com/embed/${yt}?autoplay=1&modestbranding=1&rel=0`,'_blank','noopener');
};

/* Zoom controls */
function setZoom(kind, val){
  const clamped=Math.max(0.6, Math.min(1.4, val)); // allow 60%..140%
  document.documentElement.style.setProperty(kind==='t'?'--tz':'--yz', clamped);
  localStorage.setItem(kind==='t'?'zoom_t':'zoom_y', String(clamped));
}
function stepZoom(kind, delta){
  const cur=parseFloat(getComputedStyle(document.documentElement).getPropertyValue(kind==='t'?'--tz':'--yz'))||1;
  setZoom(kind, Math.round((cur+delta)*100)/100);
}
tzOut.onclick=()=>stepZoom('t', -0.05);
tzIn.onclick=()=>stepZoom('t', +0.05);
tzReset.onclick=()=>setZoom('t', 1);
yzOut.onclick=()=>stepZoom('y', -0.05);
yzIn.onclick=()=>stepZoom('y', +0.05);
yzReset.onclick=()=>setZoom('y', 1);

/* Init */
function setVH(){ document.documentElement.style.setProperty('--vh', `${window.innerHeight*0.01}px`); }
applyFromUrl(); loadChats(); updateUrl();
if(localStorage.getItem('reading')==='1') document.body.classList.add('reading');
/* restore zooms */
const zt=parseFloat(localStorage.getItem('zoom_t')); if(zt) setZoom('t', zt);
const zy=parseFloat(localStorage.getItem('zoom_y')); if(zy) setZoom('y', zy);
setVH(); window.addEventListener('resize', setVH);
</script>
</body>
</html>
